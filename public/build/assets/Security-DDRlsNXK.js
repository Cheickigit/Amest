import{k as A,l as U,d as M,u as w,r as N,f as l,o as n,g as u,a as e,t as i,F as h,j as f,m as _,e as c,p as m,h as o,i as j,n as D,s as P}from"./app-B8f33P9o.js";import{A as E}from"./AdminLayout-K6sT7w34.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const I={class:"space-y-6"},B={key:0,class:"rounded-lg bg-emerald-500/10 text-emerald-300 ring-1 ring-emerald-500/30 px-3 py-2"},L={key:1,class:"rounded-lg bg-red-500/10 text-red-300 ring-1 ring-red-500/30 px-3 py-2"},T={key:2,class:"rounded-lg bg-white/10 text-white/80 ring-1 ring-white/15 px-3 py-2"},$={class:"grid gap-6 lg:grid-cols-3"},O={class:"panel"},R={class:"mt-4 flex items-center gap-3"},z={class:"w-12 h-12 rounded-xl bg-white/10 ring-1 ring-white/10 grid place-items-center text-lg font-bold"},H={class:"min-w-0"},Z={class:"font-semibold truncate"},G={class:"text-sm text-white/70 truncate"},J={class:"mt-4 grid gap-2 text-sm"},K={class:"flex items-center justify-between"},Q={class:"font-medium"},W={class:"flex items-center justify-between"},X={class:"font-medium"},Y={class:"mt-4"},ee={class:"flex flex-wrap gap-2"},te={key:0,class:"text-white/50 text-xs"},se={class:"panel lg:col-span-2"},oe={class:"mt-3 overflow-x-auto"},ie={class:"min-w-full text-sm"},le={class:"divide-y divide-white/10"},ne={class:"py-2"},re={key:0,class:"ml-2 text-[11px] px-1.5 py-0.5 rounded bg-bk-gold/20 text-bk-gold"},de={class:"py-2"},ae={class:"py-2"},ue={class:"py-2"},pe=["disabled","onClick"],ce={key:0},me={class:"sm:flex-1"},ge={class:"grid gap-6 lg:grid-cols-3"},xe={class:"panel"},ve={key:0,class:"text-xs text-red-300 mt-1"},we={key:0,class:"text-xs text-red-300 mt-1"},he=["disabled"],fe={class:"panel"},_e={key:0,class:"text-xs text-red-300 mt-1"},be={key:0,class:"text-xs text-red-300 mt-1"},ye=["disabled"],ke={class:"panel lg:col-span-3"},Se={class:"mt-3 overflow-x-auto"},Ce={class:"min-w-full text-sm"},Ve={class:"divide-y divide-white/10"},qe={class:"py-2"},Ae={class:"py-2"},Ue={class:"py-2"},Me={class:"py-2"},Ne={key:0},je=A({layout:E,__name:"Security",setup(De){const b=U(),r=M(()=>b.props),g=(p,t)=>P(p,t,!1,window.Ziggy),a=w({email:b.props.user.email??"",current_password:""}),S=()=>{a.post(g("admin.account.email.update"),{preserveScroll:!0,onSuccess:()=>{a.current_password=""}})},d=w({current_password:"",password:"",password_confirmation:""}),C=()=>{d.post(g("admin.account.password.update"),{preserveScroll:!0,onSuccess:()=>d.reset()})},x=w({password:""}),V=()=>x.post(g("admin.account.sessions.logout_others"),{preserveScroll:!0,onSuccess:()=>x.reset()}),v=N(null),q=p=>{v.value=p,window.setTimeout(()=>{w({}).delete(g("admin.account.sessions.revoke",{id:p}),{preserveScroll:!0,onFinish:()=>v.value=null})},0)},y=p=>{if(!p)return"N/A";const t=p.match(/(Chrome|Firefox|Safari|Edg|Opera)\/[\d.]+/i)?.[0]??p.split(" ").slice(0,2).join(" "),s=p.match(/\(([^)]+)\)/)?.[1]?.split(";")?.[0]??"";return`${t}${s?" — "+s:""}`};return(p,t)=>(n(),l("div",I,[r.value.flash?.success?(n(),l("div",B,i(r.value.flash.success),1)):u("",!0),r.value.flash?.error?(n(),l("div",L,i(r.value.flash.error),1)):u("",!0),r.value.flash?.info?(n(),l("div",T,i(r.value.flash.info),1)):u("",!0),e("div",$,[e("div",O,[t[9]||(t[9]=e("div",{class:"panel-title"},"Profil & accès",-1)),e("div",R,[e("div",z,i(r.value.user.name?.substring(0,1)?.toUpperCase()),1),e("div",H,[e("div",Z,i(r.value.user.name),1),e("div",G,i(r.value.user.email),1)])]),e("div",J,[e("div",K,[t[6]||(t[6]=e("span",{class:"text-white/60"},"Dernière connexion",-1)),e("span",Q,i(r.value.user.last_login_at??"—"),1)]),e("div",W,[t[7]||(t[7]=e("span",{class:"text-white/60"},"IP",-1)),e("span",X,i(r.value.user.last_login_ip??"—"),1)])]),e("div",Y,[t[8]||(t[8]=e("div",{class:"text-xs text-white/60 mb-1"},"Rôles",-1)),e("div",ee,[(n(!0),l(h,null,f(r.value.user.roles,s=>(n(),l("span",{key:s,class:"px-2 py-1 rounded-md text-xs bg-white/10 ring-1 ring-white/10"},i(s),1))),128)),r.value.user.roles?.length?u("",!0):(n(),l("span",te,"Aucun"))])])]),e("div",se,[t[14]||(t[14]=e("div",{class:"panel-title"},"Sessions actives",-1)),e("div",oe,[e("table",ie,[t[11]||(t[11]=e("thead",{class:"text-white/60"},[e("tr",null,[e("th",{class:"text-left font-medium pb-2"},"Appareil / navigateur"),e("th",{class:"text-left font-medium pb-2"},"IP"),e("th",{class:"text-left font-medium pb-2"},"Dernière activité"),e("th",{class:"text-left font-medium pb-2"})])],-1)),e("tbody",le,[(n(!0),l(h,null,f(r.value.sessions,s=>(n(),l("tr",{key:s.id},[e("td",ne,[j(i(y(s.agent))+" ",1),s.is_current?(n(),l("span",re,"courante")):u("",!0)]),e("td",de,i(s.ip??"—"),1),e("td",ae,i(s.last_activity),1),e("td",ue,[s.is_current?u("",!0):(n(),l("button",{key:0,class:"px-2 py-1 rounded-md text-xs bg-white/10 hover:bg-white/15 ring-1 ring-white/15",disabled:v.value===s.id,onClick:k=>q(s.id)},i(v.value===s.id?"...":"Révoquer"),9,pe))])]))),128)),r.value.sessions.length?u("",!0):(n(),l("tr",ce,[...t[10]||(t[10]=[e("td",{class:"py-3 text-white/60",colspan:"4"},"Aucune autre session.",-1)])]))])])]),e("form",{class:"mt-4 grid gap-2 sm:flex sm:items-end",onSubmit:_(V,["prevent"])},[e("div",me,[t[12]||(t[12]=e("label",{class:"text-xs text-white/60"},"Mot de passe (confirmation)",-1)),c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(x).password=s),type:"password",required:"",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50",placeholder:"Votre mot de passe"},null,512),[[m,o(x).password]])]),t[13]||(t[13]=e("button",{class:"h-10 px-3 rounded-lg bg-bk-gold text-bk-night font-semibold"},"Déconnecter les autres sessions",-1))],32)])]),e("div",ge,[e("div",xe,[t[18]||(t[18]=e("div",{class:"panel-title"},"Changer l’adresse e-mail",-1)),e("form",{class:"mt-3 grid gap-3",onSubmit:_(S,["prevent"])},[e("div",null,[t[15]||(t[15]=e("label",{class:"text-xs text-white/60"},"Nouvelle adresse e-mail",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(a).email=s),type:"email",required:"",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50",placeholder:"votre.nouvel@email.tld"},null,512),[[m,o(a).email]]),o(a).errors.email?(n(),l("div",ve,i(o(a).errors.email),1)):u("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-xs text-white/60"},"Mot de passe actuel",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(a).current_password=s),type:"password",required:"",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50"},null,512),[[m,o(a).current_password]]),o(a).errors.current_password?(n(),l("div",we,i(o(a).errors.current_password),1)):u("",!0)]),t[17]||(t[17]=e("div",{class:"text-[11px] text-white/50 -mt-1"}," ⚠️ La vérification e-mail sera réinitialisée si activée. ",-1)),e("button",{class:"h-10 px-3 rounded-lg bg-bk-gold text-bk-night font-semibold",disabled:o(a).processing},i(o(a).processing?"En cours…":"Mettre à jour l’e-mail"),9,he)],32)]),e("div",fe,[t[23]||(t[23]=e("div",{class:"panel-title"},"Changer le mot de passe",-1)),e("form",{class:"mt-3 grid gap-3",onSubmit:_(C,["prevent"])},[e("div",null,[t[19]||(t[19]=e("label",{class:"text-xs text-white/60"},"Mot de passe actuel",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(d).current_password=s),type:"password",required:"",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50"},null,512),[[m,o(d).current_password]]),o(d).errors.current_password?(n(),l("div",_e,i(o(d).errors.current_password),1)):u("",!0)]),e("div",null,[t[20]||(t[20]=e("label",{class:"text-xs text-white/60"},"Nouveau mot de passe",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(d).password=s),type:"password",required:"",minlength:"8",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50"},null,512),[[m,o(d).password]]),t[21]||(t[21]=e("div",{class:"text-[11px] text-white/50 mt-1"},"8+ caractères, robuste recommandé.",-1)),o(d).errors.password?(n(),l("div",be,i(o(d).errors.password),1)):u("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-xs text-white/60"},"Confirmation",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o(d).password_confirmation=s),type:"password",required:"",class:"mt-1 w-full h-10 rounded-lg bg-white/[.06] ring-1 ring-white/10 px-3 text-sm outline-none focus:ring-bk-gold/50"},null,512),[[m,o(d).password_confirmation]])]),e("button",{class:"h-10 px-3 rounded-lg bg-bk-gold text-bk-night font-semibold",disabled:o(d).processing},i(o(d).processing?"En cours…":"Mettre à jour"),9,ye)],32)]),e("div",ke,[t[26]||(t[26]=e("div",{class:"panel-title"},"Historique de connexion",-1)),e("div",Se,[e("table",Ce,[t[25]||(t[25]=e("thead",{class:"text-white/60"},[e("tr",null,[e("th",{class:"text-left font-medium pb-2"},"Événement"),e("th",{class:"text-left font-medium pb-2"},"IP"),e("th",{class:"text-left font-medium pb-2"},"Navigateur"),e("th",{class:"text-left font-medium pb-2"},"Date")])],-1)),e("tbody",Ve,[(n(!0),l(h,null,f(r.value.logs,(s,k)=>(n(),l("tr",{key:k},[e("td",qe,[e("span",{class:D(["px-2 py-0.5 rounded text-xs",s.event==="login_success"?"bg-emerald-500/15 text-emerald-300 ring-1 ring-emerald-500/30":s.event==="login_failed"?"bg-red-500/15 text-red-300 ring-1 ring-red-500/30":"bg-white/10 text-white/80 ring-1 ring-white/15"])},i(s.event),3)]),e("td",Ae,i(s.ip_address??"—"),1),e("td",Ue,i(y(s.user_agent)),1),e("td",Me,i(s.created_at),1)]))),128)),r.value.logs.length?u("",!0):(n(),l("tr",Ne,[...t[24]||(t[24]=[e("td",{class:"py-3 text-white/60",colspan:"4"},"Aucun événement pour le moment.",-1)])]))])])])])])]))}}),Ie=F(je,[["__scopeId","data-v-4dd6ba7f"]]);export{Ie as default};
