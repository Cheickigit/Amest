import{k as T,d as N,u as $,r as w,y as H,q as G,x as O,f as l,o as n,a as e,g as a,b as I,t as u,w as K,i as h,s as Z,h as o,A as q,B as P,m as V,e as g,p,D as Y,F as y,j as U,n as B,z as j}from"./app-B8f33P9o.js";import{A as J}from"./AdminLayout-K6sT7w34.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"max-w-7xl mx-auto text-white"},W={class:"sticky top-0 z-20 -mx-2 px-2 bg-bk-night/85 backdrop-blur border-b border-white/10"},X={class:"h-14 flex items-center gap-2"},ee={class:"flex-1"},te={class:"font-semibold"},se={viewBox:"0 0 24 24",width:"16",height:"16"},ie=["d"],oe=["disabled"],le={viewBox:"0 0 24 24",width:"16",height:"16"},ne=["d"],re={key:0,class:"h-1 mb-2 rounded bg-white/10 overflow-hidden"},de={key:0,class:"mt-4 mb-4 rounded-xl bg-red-500/10 ring-1 ring-red-500/30 text-red-200 px-4 py-3"},ae={class:"grid lg:grid-cols-[1fr_360px] gap-6"},ue={class:"grid md:grid-cols-2 gap-4"},ge={class:"grid gap-1"},pe={key:0,class:"text-xs text-red-300"},ce={class:"grid gap-1"},he={key:0,class:"text-xs text-red-300"},xe={class:"grid md:grid-cols-4 gap-4"},me={class:"grid gap-1"},ve={class:"grid gap-1"},fe={class:"grid gap-1"},be={class:"grid gap-1"},we={key:0,class:"text-xs text-red-300"},ye={class:"grid gap-1"},_e={class:"grid gap-1"},ke={class:"grid md:grid-cols-2 gap-4"},Ce={class:"grid gap-1"},Ve={key:0,class:"text-xs text-white/60"},Ue={class:"underline"},Be={key:1,class:"text-xs text-red-300"},je={class:"grid gap-2"},ze={class:"rounded-xl ring-1 ring-white/10 bg-white/[.04] p-4"},Me={class:"grid gap-3"},Se={class:"inline-flex items-center gap-2 text-sm cursor-pointer"},De={viewBox:"0 0 24 24",width:"16",height:"16"},Ae=["d"],Le={key:0,class:"text-xs text-white/70"},Fe={key:1,class:"text-xs text-red-300"},Ee={class:"grid gap-2"},Re={class:"flex gap-2"},Te=["onKeyup"],Ne={viewBox:"0 0 24 24",width:"14",height:"14"},$e=["d"],He={key:0,class:"space-y-1"},Ge=["href"],Oe=["onClick"],Ie={viewBox:"0 0 24 24",width:"12",height:"12"},Ke=["d"],Ze={class:"inline-flex rounded-lg bg-white/5 ring-1 ring-white/10 p-1 h-10"},qe={class:"pt-1"},Pe=["disabled"],Ye={viewBox:"0 0 24 24",width:"16",height:"16"},Je=["d"],Qe={class:"lg:sticky lg:top-16 h-max space-y-3"},We={class:"rounded-2xl overflow-hidden ring-1 ring-white/10 bg-white/[.04]"},Xe={class:"aspect-video bg-white/5 grid place-items-center overflow-hidden"},et=["src"],tt=["src"],st={key:2,class:"text-white/40 text-sm"},it={key:0,class:"rounded-2xl ring-1 ring-white/10 bg-white/[.04] p-3"},ot={class:"flex gap-1 flex-wrap"},lt=["src"],nt={key:1,class:"h-12 w-16 grid place-items-center rounded ring-1 ring-white/10 text-[10px] text-white/70 bg-white/5"},rt=1980,dt=2100,ct=T({layout:J,__name:"Form",props:{item:{}},setup(z){const x=(r,t,i=!1)=>Z(r,t??{},i,window.Ziggy),m={upload:"M5 17h14v2H5v-2zm7-12l5 5h-3v4h-4v-4H7l5-5z",link:"M3.9 12a5 5 0 0 1 5-5h3v2h-3a3 3 0 1 0 0 6h3v2h-3a5 5 0 0 1-5-5Zm7-1h2v2h-2v-2Zm3.1-4h3a5 5 0 1 1 0 10h-3v-2h3a3 3 0 1 0 0-6h-3V7Z",trash:"M6 7h12v2H6zm2 3h8l-1 10H9L8 10zm3-5h2l1 2H10l1-2z",save:"M17 3H5a2 2 0 0 0-2 2v14h18V7l-4-4zM12 19a4 4 0 1 1 0-8a4 4 0 0 1 0 8z"},d=z,v=N(()=>!!d.item?.id),s=$({title:d.item?.title??"",slug:d.item?.slug??"",category:d.item?.category??"",city:d.item?.city??"",client:d.item?.client??"",year:d.item?.year??null,status:d.item?.status??"brouillon",excerpt:d.item?.excerpt??"",body:d.item?.body??"",cover:null,media_uploads:[],video_urls:[]}),_=w(!1);function M(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").slice(0,200)}H(()=>s.title,r=>{_.value||(s.slug=M(String(r||"")))});function S(){_.value=!0}G(()=>{const r=(d.item?.media??[]).filter(t=>t.type==="video"&&t.kind==="url"&&t.url).map(t=>t.url);r.length&&(s.video_urls=r)});const c=w(null);function D(r){const t=r.target;s.cover=t.files?.[0]??null,c.value&&URL.revokeObjectURL(c.value),c.value=s.cover?URL.createObjectURL(s.cover):null}O(()=>{c.value&&URL.revokeObjectURL(c.value)});function A(r){const t=r.target;s.media_uploads=t.files?Array.from(t.files):[]}function L(r){r.preventDefault()}function F(r){r.preventDefault();const t=Array.from(r.dataTransfer?.files||[]);t.length&&(s.media_uploads=[...s.media_uploads,...t])}const f=w("");function k(){const r=f.value.trim();if(r){if(!/^https?:\/\//i.test(r)){alert("URL invalide");return}s.video_urls.push(r),f.value=""}}function E(r){s.video_urls.splice(r,1)}function C(){const r=v.value?x("admin.projects.update",d.item.id):x("admin.projects.store");s.clearErrors(),s.transform(i=>({...i,title:String(i.title??""),slug:String(i.slug??""),year:i.year?Number(i.year):null,video_urls:Array.isArray(i.video_urls)?i.video_urls:[],...v.value?{_method:"PUT"}:{}}));const t={forceFormData:!0,preserveScroll:!0,onSuccess:()=>{s.media_uploads=[],s.cover=null,j.visit(x("admin.projects.index"))},onFinish:()=>{s.transform(i=>({...i,_method:void 0}))}};s.post(r,t)}function R(){d.item?.id&&confirm("Supprimer définitivement cette réalisation ?")&&s.delete(x("admin.projects.destroy",d.item.id),{preserveScroll:!0,onSuccess:()=>j.visit(x("admin.projects.index"))})}return(r,t)=>(n(),l("div",Q,[e("div",W,[e("div",X,[e("div",ee,[t[11]||(t[11]=e("div",{class:"text-[11px] text-white/50 leading-none"},"BKO Construction / Back-office",-1)),e("div",te,u(v.value?"Modifier une réalisation":"Nouvelle réalisation"),1)]),I(o(q),{href:x("admin.projects.index"),class:"px-3 h-9 inline-flex items-center rounded-lg bg-white/10 hover:bg-white/15"},{default:K(()=>[...t[12]||(t[12]=[h(" Retour ",-1)])]),_:1},8,["href"]),v.value?(n(),l("button",{key:0,type:"button",onClick:R,class:"px-3 h-9 inline-flex items-center gap-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-200"},[(n(),l("svg",se,[e("path",{d:m.trash,fill:"currentColor"},null,8,ie)])),t[13]||(t[13]=h(" Supprimer ",-1))])):a("",!0),e("button",{type:"button",disabled:o(s).processing,onClick:C,class:"px-4 h-9 inline-flex items-center gap-2 rounded-lg bg-bk-gold text-bk-night font-bold hover:brightness-95 disabled:opacity-60"},[(n(),l("svg",le,[t[14]||(t[14]=e("defs",null,[e("linearGradient",{id:"g-sav",x1:"0",y1:"0",x2:"1",y2:"1"},[e("stop",{offset:"0%","stop-color":"#F5E7B7"}),e("stop",{offset:"100%","stop-color":"#DCC176"})])],-1)),e("path",{fill:"url(#g-sav)",d:m.save},null,8,ne)])),h(" "+u(v.value?"Mettre à jour":"Enregistrer"),1)],8,oe)]),o(s).progress?(n(),l("div",re,[e("div",{class:"h-1 bg-bk-gold",style:P({width:`${o(s).progress.percentage}%`})},null,4)])):a("",!0)]),Object.keys(o(s).errors).length?(n(),l("div",de," Merci de corriger les champs indiqués ci-dessous. ")):a("",!0),e("div",ae,[e("form",{onSubmit:V(C,["prevent"]),class:"grid gap-5"},[e("div",ue,[e("label",ge,[t[15]||(t[15]=e("span",{class:"text-white/70 text-sm"},"Titre *",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>o(s).title=i),required:"",class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).title]]),o(s).errors.title?(n(),l("span",pe,u(o(s).errors.title),1)):a("",!0)]),e("label",ce,[t[16]||(t[16]=e("span",{class:"text-white/70 text-sm"},"Slug",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>o(s).slug=i),onInput:S,class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,544),[[p,o(s).slug]]),o(s).errors.slug?(n(),l("span",he,u(o(s).errors.slug),1)):a("",!0)])]),e("div",xe,[e("label",me,[t[17]||(t[17]=e("span",{class:"text-white/70 text-sm"},"Catégorie",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>o(s).category=i),class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).category]])]),e("label",ve,[t[18]||(t[18]=e("span",{class:"text-white/70 text-sm"},"Ville",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>o(s).city=i),class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).city]])]),e("label",fe,[t[19]||(t[19]=e("span",{class:"text-white/70 text-sm"},"Client",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>o(s).client=i),class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).client]])]),e("label",be,[t[20]||(t[20]=e("span",{class:"text-white/70 text-sm"},[h("Année "),e("span",{class:"text-white/40"},"(1980–2100)")],-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>o(s).year=i),type:"number",min:rt,max:dt,class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).year]]),o(s).errors.year?(n(),l("span",we,u(o(s).errors.year),1)):a("",!0)])]),e("label",ye,[t[21]||(t[21]=e("span",{class:"text-white/70 text-sm"},"Résumé",-1)),g(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=i=>o(s).excerpt=i),rows:"2",class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).excerpt]])]),e("label",_e,[t[22]||(t[22]=e("span",{class:"text-white/70 text-sm"},"Contenu",-1)),g(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=i=>o(s).body=i),rows:"6",class:"bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none"},null,512),[[p,o(s).body]])]),e("div",ke,[e("label",Ce,[t[24]||(t[24]=e("span",{class:"text-white/70 text-sm"},"Image de couverture",-1)),e("input",{type:"file",accept:"image/*",onChange:D},null,32),d.item?.cover_image&&!c.value?(n(),l("div",Ve,[t[23]||(t[23]=h(" Actuelle : ",-1)),e("span",Ue,"/storage/"+u(d.item.cover_image),1)])):a("",!0),o(s).errors.cover?(n(),l("span",Be,u(o(s).errors.cover),1)):a("",!0)]),e("div",je,[t[28]||(t[28]=e("span",{class:"text-white/70 text-sm"},"Médias (images / vidéos)",-1)),e("div",ze,[e("div",Me,[e("label",Se,[(n(),l("svg",De,[t[25]||(t[25]=e("defs",null,[e("linearGradient",{id:"g-up",x1:"0",y1:"0",x2:"1",y2:"1"},[e("stop",{offset:"0%","stop-color":"#F5E7B7"}),e("stop",{offset:"100%","stop-color":"#DCC176"})])],-1)),e("path",{fill:"url(#g-up)",d:m.upload},null,8,Ae)])),t[26]||(t[26]=e("span",null,"Téléverser des fichiers",-1)),e("input",{type:"file",multiple:"",accept:"image/*,video/*",class:"hidden",onChange:A},null,32)]),e("div",{class:"rounded-lg border border-dashed border-white/15 bg-white/[.03] p-6 text-center",onDragover:L,onDrop:F},[...t[27]||(t[27]=[e("div",{class:"text-white/70 text-sm"},"Glissez-déposez vos fichiers ici",-1),e("div",{class:"text-xs text-white/50 mt-1"},"8 Mo max / fichier",-1)])],32),o(s).media_uploads.length?(n(),l("div",Le,u(o(s).media_uploads.length)+" fichier(s) prêt(s) à l’envoi ",1)):a("",!0),o(s).errors["media_uploads.0"]?(n(),l("span",Fe,u(o(s).errors["media_uploads.0"]),1)):a("",!0)])])])]),e("div",Ee,[t[32]||(t[32]=e("span",{class:"text-white/70 text-sm"},"Liens vidéo (YouTube, Vimeo…)",-1)),e("div",Re,[g(e("input",{"onUpdate:modelValue":t[8]||(t[8]=i=>f.value=i),placeholder:"https://…",class:"flex-1 bg-white/5 ring-1 ring-white/10 focus:ring-bk-gold/50 rounded-lg px-3 py-2 outline-none",onKeyup:Y(V(k,["prevent"]),["enter"])},null,40,Te),[[p,f.value]]),e("button",{type:"button",class:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/15 inline-flex items-center gap-2",onClick:k},[(n(),l("svg",Ne,[t[29]||(t[29]=e("defs",null,[e("linearGradient",{id:"g-li",x1:"0",y1:"0",x2:"1",y2:"1"},[e("stop",{offset:"0%","stop-color":"#F5E7B7"}),e("stop",{offset:"100%","stop-color":"#DCC176"})])],-1)),e("path",{fill:"url(#g-li)",d:m.link},null,8,$e)])),t[30]||(t[30]=h(" Ajouter ",-1))])]),o(s).video_urls.length?(n(),l("ul",He,[(n(!0),l(y,null,U(o(s).video_urls,(i,b)=>(n(),l("li",{key:i,class:"flex items-center gap-2 text-sm"},[e("a",{href:i,target:"_blank",class:"flex-1 truncate hover:text-bk-gold"},u(i),9,Ge),e("button",{type:"button",class:"text-red-300/90 hover:text-red-200 text-xs inline-flex items-center gap-1",onClick:at=>E(b)},[(n(),l("svg",Ie,[e("path",{d:m.trash,fill:"currentColor"},null,8,Ke)])),t[31]||(t[31]=h(" Suppr. ",-1))],8,Oe)]))),128))])):a("",!0)]),e("div",Ze,[e("button",{type:"button",onClick:t[9]||(t[9]=i=>o(s).status="brouillon"),class:B(["px-2.5 text-xs rounded-md",o(s).status==="brouillon"?"bg-bk-gold text-bk-night font-semibold":"text-white/80 hover:text-white"])}," Brouillon ",2),e("button",{type:"button",onClick:t[10]||(t[10]=i=>o(s).status="publié"),class:B(["px-2.5 text-xs rounded-md",o(s).status==="publié"?"bg-bk-gold text-bk-night font-semibold":"text-white/80 hover:text-white"])}," Publié ",2)]),e("div",qe,[e("button",{disabled:o(s).processing,class:"px-4 h-10 inline-flex items-center gap-2 rounded-lg bg-bk-gold text-bk-night font-bold hover:brightness-95 disabled:opacity-60"},[(n(),l("svg",Ye,[t[33]||(t[33]=e("defs",null,[e("linearGradient",{id:"g-sav2",x1:"0",y1:"0",x2:"1",y2:"1"},[e("stop",{offset:"0%","stop-color":"#F5E7B7"}),e("stop",{offset:"100%","stop-color":"#DCC176"})])],-1)),e("path",{fill:"url(#g-sav2)",d:m.save},null,8,Je)])),h(" "+u(v.value?"Mettre à jour":"Enregistrer"),1)],8,Pe)])],32),e("aside",Qe,[e("div",We,[t[34]||(t[34]=e("div",{class:"p-3 text-sm text-white/70"},"Aperçu — image de couverture",-1)),e("div",Xe,[c.value?(n(),l("img",{key:0,src:c.value,class:"w-full h-full object-cover",alt:""},null,8,et)):d.item?.cover_image?(n(),l("img",{key:1,src:`/storage/${d.item.cover_image}`,class:"w-full h-full object-cover",alt:""},null,8,tt)):(n(),l("div",st,"Aucune couverture"))])]),d.item?.media?.length?(n(),l("div",it,[t[35]||(t[35]=e("div",{class:"text-sm text-white/70 mb-2"},"Médias existants",-1)),e("div",ot,[(n(!0),l(y,null,U(d.item.media.slice(0,12),(i,b)=>(n(),l(y,{key:b},[i.type==="image"&&i.path?(n(),l("img",{key:0,src:`/storage/${i.path}`,class:"h-12 w-16 object-cover rounded ring-1 ring-white/10"},null,8,lt)):i.type==="video"?(n(),l("div",nt," Vidéo ")):a("",!0)],64))),128))])])):a("",!0)])])]))}});export{ct as default};
