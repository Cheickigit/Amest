import{k as ne,l as oe,d as H,r as M,q as de,x as re,y as U,z as ce,f as i,o as l,a as t,i as c,t as p,e as Y,v as ue,g as ve,p as he,n as P,b as v,w as S,h as B,A,F as L,j as K,s as pe,B as ge,c as me}from"./app-B8f33P9o.js";import{A as fe}from"./AdminLayout-K6sT7w34.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"space-y-6"},_e={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},we={class:"flex items-center gap-3"},ye={class:"hidden md:flex items-center gap-2 text-xs text-white/50"},ke={class:"ml-2 inline-flex items-center gap-2 text-xs text-white/70 select-none"},Me={class:"flex flex-col sm:flex-row gap-2 sm:items-center"},Pe={class:"relative"},Ce={viewBox:"0 0 24 24",class:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-white/60"},je=["d"],Se={class:"grid grid-cols-4 gap-1 rounded-lg bg-white/[.06] ring-1 ring-white/10 p-1 h-10"},Be={class:"hidden lg:flex gap-2"},Ae={viewBox:"0 0 24 24",class:"w-4 h-4"},Le=["d"],$e={viewBox:"0 0 24 24",class:"w-4 h-4"},Fe=["d"],De={class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4"},Te={class:"grid gap-6 xl:grid-cols-3"},Ve={class:"panel xl:col-span-2"},ze={class:"panel-title flex items-center gap-2"},qe={viewBox:"0 0 24 24",class:"w-4 h-4 opacity-80"},Ne=["d"],Re={class:"mt-1 text-sm text-white/60"},Ee={key:0,class:"mt-6 text-sm text-white/60"},Ie={viewBox:"0 0 420 120",class:"mt-4 w-full h-36"},He=["d"],Ue=["d"],Ye={class:"mt-3 grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm"},Ke={class:"stat-chip"},Oe={class:"text-white/90 font-semibold"},Xe={class:"stat-chip"},Qe={class:"text-white/90 font-semibold"},Ze={class:"panel"},Ge={class:"mt-4 grid grid-cols-3 gap-4"},Je={class:"mt-5 border-t border-white/10 pt-4 grid sm:grid-cols-2 gap-3"},We={class:"grid gap-6 lg:grid-cols-2"},et={class:"panel"},tt={key:0,class:"mt-3 text-sm text-white/60"},st={key:1,class:"mt-4 grid gap-3"},lt={class:"min-w-[140px] text-sm text-white/80"},at={class:"flex-1 h-2 rounded-full bg-white/10 overflow-hidden"},it={class:"w-14 text-right text-sm font-semibold"},nt={class:"panel"},ot={key:0,class:"mt-3 text-sm text-white/60"},dt={key:1,class:"mt-3 divide-y divide-white/10"},rt={class:"inline-flex w-9 h-9 items-center justify-center rounded-lg bg-white/10 ring-1 ring-white/10"},ct={viewBox:"0 0 24 24",class:"w-5 h-5 text-bk-gold"},ut=["d"],vt={class:"min-w-0 flex-1"},ht={class:"text-sm font-medium truncate"},pt={key:1},gt={class:"text-xs text-white/60"},mt=2e4,ft=ne({layout:fe,__name:"Dashboard",setup(xt){const O=oe(),o=H(()=>O.props);function x(a,e,s=!1,y="#"){try{return pe(a,e??{},s,globalThis.Ziggy)}catch{return y}}const m=M(""),h=M(o.value.filters?.range??"30d"),b=M(!0),$=M(new Date().toLocaleTimeString());let _=null;de(()=>{const a=e=>{e.key==="/"&&(e.preventDefault(),document.getElementById("global-search")?.focus())};window.addEventListener("keydown",a,{passive:!0}),F()}),re(()=>C());function F(){C(),b.value&&(_=setInterval(()=>f(!0),mt))}function C(){_&&(clearInterval(_),_=null)}U(b,a=>a?F():C());function f(a=!1){ce.get(x("admin.dashboard"),{range:h.value,q:m.value},{preserveState:!0,preserveScroll:!0,replace:a}),$.value=new Date().toLocaleTimeString()}let D=null;U(m,()=>{clearTimeout(D),D=setTimeout(()=>f(!0),450)});const X={num:a=>Intl.NumberFormat("fr-FR").format(a),pct:a=>`${a}%`};function T(a,e=420,s=120){if(!a?.length)return"";const y=a.map(n=>Date.parse(n.x)),z=a.map(n=>n.y),q=Math.min(...y),Z=Math.max(...y),N=Math.min(...z),G=Math.max(...z),J=Z-q||1,W=G-N||1,ee=n=>(n-q)/J*(e-12)+6,te=n=>s-((n-N)/W*(s-12)+6),u=a.map(n=>[ee(Date.parse(n.x)),te(n.y)]);if(u.length<2)return`M ${u[0][0]} ${u[0][1]}`;const R=[`M ${u[0][0]} ${u[0][1]}`];for(let n=0;n<u.length-1;n++){const E=u[n-1]||u[n],k=u[n],g=u[n+1],I=u[n+2]||g,se=k[0]+(g[0]-E[0])/6,le=k[1]+(g[1]-E[1])/6,ae=g[0]-(I[0]-k[0])/6,ie=g[1]-(I[1]-k[1])/6;R.push(`C ${se.toFixed(2)} ${le.toFixed(2)}, ${ae.toFixed(2)} ${ie.toFixed(2)}, ${g[0].toFixed(2)} ${g[1].toFixed(2)}`)}return R.join(" ")}const r={folder:"M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z",users:"M16 11a4 4 0 1 0-8 0a4 4 0 0 0 8 0zM4 20a8 8 0 1 1 16 0H4z",fileText:"M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6zM14 2v6h6",pen:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41L18.37 3.29a1 1 0 0 0-1.41 0l-1.34 1.34l3.75 3.75l1.34-1.34z",message:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z",plus:"M12 5v14M5 12h14",search:"M10 2a8 8 0 1 0 5.29 14.29l4.21 4.21l1.41-1.41l-4.21-4.21A8 8 0 0 0 10 2z",chart:"M4 19h16M7 15v-6M12 19V5M17 19v-9"},d=H(()=>({projects:o.value.metrics?.projects??{label:"Projets",value:0,delta:0,hint:"En portefeuille"},leads:o.value.metrics?.leads??{label:"Leads",value:0,delta:0,hint:"Derniers 30 jours"},rfps:o.value.metrics?.rfps??{label:"AO",value:0,delta:0,hint:"Ouverts"},posts:o.value.metrics?.posts??{label:"Articles",value:0,delta:0,hint:"Brouillons"}})),w={props:{label:String,value:[String,Number],delta:Number,hint:String,iconPath:String},template:`
  <div class="relative rounded-2xl p-[1px]
              bg-[conic-gradient(at_22%_20%,rgba(220,193,118,.9),rgba(255,255,255,.14),rgba(220,193,118,.9))]">
    <div class="rounded-2xl h-full bg-white/[.06] backdrop-blur ring-1 ring-white/10 p-4">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-sm text-white/70">{{ label }}</div>
          <div class="mt-1 text-3xl font-extrabold tracking-tight">{{ String(value) }}</div>
        </div>
        <div class="shrink-0">
          <div class="w-11 h-11 rounded-xl grid place-items-center
                      bg-[radial-gradient(circle_at_30%_30%,#fff8,transparent_60%)] ring-1 ring-white/10">
            <svg viewBox="0 0 24 24" class="w-6 h-6 text-bk-gold"><path :d="iconPath" fill="currentColor"/></svg>
          </div>
        </div>
      </div>
      <div v-if="hint" class="mt-1 text-[12px] text-white/60">{{ hint }}</div>

      <div v-if="delta !== undefined"
           :class="['mt-3 inline-flex items-center gap-1 text-xs font-semibold px-1.5 py-0.5 rounded',
                    delta>0 ? 'text-emerald-300 bg-emerald-500/10 ring-1 ring-emerald-500/30'
                            : delta<0 ? 'text-red-300 bg-red-500/10 ring-1 ring-red-500/30'
                                      : 'text-white/80 bg-white/10 ring-1 ring-white/15']">
        <span>{{ delta>0 ? '↑' : delta<0 ? '↓' : '•' }}</span>
        <span>{{ Math.abs(delta) }}%</span>
      </div>
    </div>
  </div>`},j={props:{label:String,value:{type:Number,required:!0}},template:`
  <div class="grid place-items-center gap-2">
    <div class="relative w-24 h-24 rounded-full ring-1 ring-white/10"
         :style="{ background: 'conic-gradient(#dcc176 ' + value + '%, rgba(255,255,255,.12) 0)' }">
      <div class="absolute inset-3 rounded-full bg-[#151e27] ring-1 ring-white/10 grid place-items-center text-sm font-bold">
        {{ value }}%
      </div>
    </div>
    <div class="text-xs text-white/70">{{ label }}</div>
  </div>`},V={props:{to:String,iconPath:String,label:String},methods:{r:x},template:`
  <a :href="r(to)" class="inline-flex items-center gap-2 rounded-lg px-3 py-2
                          bg-white/[.06] ring-1 ring-white/10 hover:ring-bk-gold/60
                          hover:-translate-y-0.5 transition will-change-transform">
    <svg viewBox="0 0 24 24" class="w-4 h-4 text-bk-gold"><path :d="iconPath" fill="currentColor"/></svg>
    <span class="text-sm font-medium">{{ label }}</span>
  </a>`};function Q(a){const e=(a||"").toLowerCase();return e.includes("devis")||e.includes("lead")?r.message:e.includes("projet")||e.includes("vrd")||e.includes("chantier")?r.folder:e.includes("article")||e.includes("post")?r.pen:e.includes("ao")||e.includes("appel")?r.fileText:r.search}return(a,e)=>(l(),i("div",be,[t("div",_e,[t("div",we,[e[9]||(e[9]=t("div",{class:"text-lg font-semibold"},[c("BKO "),t("span",{class:"text-bk-gold"},"Construction"),c(" · Admin")],-1)),t("div",ye,[e[7]||(e[7]=t("span",{class:"inline-block w-2 h-2 rounded-full bg-bk-gold/70 animate-pulse"},null,-1)),c(" Live · maj "+p($.value),1)]),t("label",ke,[Y(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"accent-bk-gold"},null,512),[[ue,b.value]]),e[8]||(e[8]=c(" Auto-refresh ",-1))])]),t("div",Me,[t("div",Pe,[Y(t("input",{id:"global-search","onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),type:"search",inputmode:"search",placeholder:"Rechercher ( / )",class:"h-10 w-[260px] rounded-lg bg-white/[.06] ring-1 ring-white/10 pl-9 pr-8 text-sm placeholder:text-white/50 outline-none focus:ring-bk-gold/50"},null,512),[[he,m.value]]),(l(),i("svg",Ce,[t("path",{d:r.search,fill:"currentColor"},null,8,je)])),m.value?(l(),i("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-white/50 hover:text-white",onClick:e[2]||(e[2]=s=>m.value="")},"✕")):ve("",!0)]),t("div",Se,[t("button",{onClick:e[3]||(e[3]=s=>{h.value="7d",f()}),class:P(["chip",h.value==="7d"?"chip--active":""])},"7j",2),t("button",{onClick:e[4]||(e[4]=s=>{h.value="30d",f()}),class:P(["chip",h.value==="30d"?"chip--active":""])},"30j",2),t("button",{onClick:e[5]||(e[5]=s=>{h.value="q",f()}),class:P(["chip",h.value==="q"?"chip--active":""])},"Trim.",2),t("button",{onClick:e[6]||(e[6]=s=>{h.value="ytd",f()}),class:P(["chip",h.value==="ytd"?"chip--active":""])},"YTD",2)]),t("div",Be,[v(B(A),{href:x("admin.quotes.index"),class:"h-10 inline-flex items-center gap-2 rounded-lg px-3 bg-bk-gold text-bk-night font-semibold shadow-[0_16px_40px_-16px_rgba(220,193,118,.45)] hover:-translate-y-0.5 transition"},{default:S(()=>[(l(),i("svg",Ae,[t("path",{d:r.message,fill:"currentColor"},null,8,Le)])),e[10]||(e[10]=c(" Leads ",-1))]),_:1},8,["href"]),v(B(A),{href:x("admin.projects.index"),class:"h-10 inline-flex items-center gap-2 rounded-lg px-3 bg-white/[.06] ring-1 ring-white/10 hover:ring-bk-gold/60"},{default:S(()=>[(l(),i("svg",$e,[t("path",{d:r.folder,fill:"currentColor"},null,8,Fe)])),e[11]||(e[11]=c(" Projets ",-1))]),_:1},8,["href"])])])]),t("div",De,[v(w,{label:d.value.projects.label,value:d.value.projects.value,delta:d.value.projects.delta,iconPath:r.folder,hint:d.value.projects.hint},null,8,["label","value","delta","iconPath","hint"]),v(w,{label:d.value.leads.label,value:d.value.leads.value,delta:d.value.leads.delta,iconPath:r.users,hint:d.value.leads.hint},null,8,["label","value","delta","iconPath","hint"]),v(w,{label:d.value.rfps.label,value:d.value.rfps.value,delta:d.value.rfps.delta,iconPath:r.fileText,hint:d.value.rfps.hint},null,8,["label","value","delta","iconPath","hint"]),v(w,{label:d.value.posts.label,value:d.value.posts.value,delta:d.value.posts.delta,iconPath:r.pen,hint:d.value.posts.hint},null,8,["label","value","delta","iconPath","hint"])]),t("div",Te,[t("div",Ve,[t("div",ze,[e[12]||(e[12]=c(" Flux de leads ",-1)),(l(),i("svg",qe,[t("path",{d:r.chart,fill:"currentColor"},null,8,Ne)]))]),t("div",Re,"Période : "+p(h.value?.toUpperCase()),1),o.value.trends.leads?.data?.length?(l(),i(L,{key:1},[(l(),i("svg",Ie,[e[13]||(e[13]=t("defs",null,[t("linearGradient",{id:"gArea",x1:"0",y1:"0",x2:"0",y2:"1"},[t("stop",{offset:"0%","stop-color":"#dcc176","stop-opacity":"0.35"}),t("stop",{offset:"100%","stop-color":"#dcc176","stop-opacity":"0.02"})])],-1)),t("path",{d:T(o.value.trends.leads.data,420,120)+" L 420 120 L 0 120 Z",fill:"url(#gArea)"},null,8,He),t("path",{d:T(o.value.trends.leads.data,420,120),fill:"none",stroke:"#dcc176","stroke-width":"2.5","vector-effect":"non-scaling-stroke"},null,8,Ue)])),t("div",Ye,[e[16]||(e[16]=t("div",{class:"stat-chip"},[t("span",{class:"dot bg-bk-gold"}),c("Leads")],-1)),e[17]||(e[17]=t("div",{class:"stat-chip"},[t("span",{class:"dot bg-white/25"}),c("Référence")],-1)),t("div",Ke,[e[14]||(e[14]=c("Max: ",-1)),t("span",Oe,p(X.num(Math.max(...o.value.trends.leads.data.map(s=>s.y)))),1)]),t("div",Xe,[e[15]||(e[15]=c("Points: ",-1)),t("span",Qe,p(o.value.trends.leads.data.length),1)])])],64)):(l(),i("div",Ee,"Pas encore de données de leads."))]),t("div",Ze,[e[18]||(e[18]=t("div",{class:"panel-title"},"SLA & Satisfaction",-1)),t("div",Ge,[v(j,{label:"Délais",value:o.value.slas.ontime},null,8,["value"]),v(j,{label:"Qualité",value:o.value.slas.quality},null,8,["value"]),v(j,{label:"Satisfaction",value:o.value.slas.satisfaction},null,8,["value"])]),t("div",Je,[v(V,{to:"admin.quotes.index",iconPath:r.message,label:"Voir les leads"},null,8,["iconPath"]),v(V,{to:"admin.projects.create",iconPath:r.plus,label:"Créer un projet"},null,8,["iconPath"])])])]),t("div",We,[t("div",et,[e[19]||(e[19]=t("div",{class:"panel-title"},"Projets par segment",-1)),o.value.bySegment.length?(l(),i("div",st,[(l(!0),i(L,null,K(o.value.bySegment,s=>(l(),i("div",{key:s.label,class:"flex items-center gap-3"},[t("div",lt,p(s.label),1),t("div",at,[t("div",{class:"h-full rounded-full bg-bk-gold",style:ge({width:Math.min(100,Math.max(0,s.value))+"%"})},null,4)]),t("div",it,p(s.value)+"%",1)]))),128))])):(l(),i("div",tt,"Aucun segment."))]),t("div",nt,[e[20]||(e[20]=t("div",{class:"panel-title"},"Activité récente",-1)),o.value.activity.length?(l(),i("ul",dt,[(l(!0),i(L,null,K(o.value.activity,s=>(l(),i("li",{key:s.id,class:"py-3 flex items-center gap-3"},[t("span",rt,[(l(),i("svg",ct,[t("path",{d:Q(s.type),fill:"currentColor"},null,8,ut)]))]),t("div",vt,[t("div",ht,[s.url?(l(),me(B(A),{key:0,href:s.url,class:"hover:text-bk-gold"},{default:S(()=>[c(p(s.title),1)]),_:2},1032,["href"])):(l(),i("span",pt,p(s.title),1))]),t("div",gt,p(s.when),1)])]))),128))])):(l(),i("div",ot,"Flux à venir…"))])])]))}}),yt=xe(ft,[["__scopeId","data-v-4346662f"]]);export{yt as default};
